---
title: "p8105_hw3_js5431"
author: "J Shearston"
date: "October 6, 2018"
output: 
  github_document:
    toc: true
---

```{r setup, include=FALSE}
library(tidyverse)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_bw() + theme(legend.position = "bottom"))

```


## Problem #1

#### Data Import and Cleaning

```{r load & clean BRFSS}

library(p8105.datasets)

brfss = p8105.datasets::brfss_smart2010 %>% 
  janitor::clean_names() %>%
  rename(state = locationabbr, 
         county = locationdesc) %>% 
  filter(topic == "Overall Health") %>%
  arrange(year, state, county) %>% 
  mutate(response = as.factor(response)) %>% 
  select(year, state, county, response, sample_size, data_value)


```


#### Questions and Responses

* In 2002, which states were observed at 7 locations?
    + In 2002, 3 states were observed at 7 locations: Connecticut, Florida, and North Carolina.
    
```{r states observed at 7 loc.}

 brfss %>% 
  filter(year == "2002") %>% 
  group_by(state) %>% 
  summarize(n_counties = n_distinct(county)) %>% 
  filter(n_counties == 7)

```
    

* Make a “spaghetti plot” that shows the number of observations in each state from 2002 to 2010.
    + This plot is horrifying. I removed the legend, as trying to determine which line represents which individual state is anxiety inducing. Overall, I would say that this plot shows that for most states, the total number of observations has remained fairly constant over time, with a few states having very large variability.

```{r spaghetti plot - obs by state}

brfss %>%
  group_by(year, state) %>% 
  summarize(obs_state = sum(sample_size)) %>% 
  ggplot(aes(x = year, y = obs_state, color = state)) +
  geom_line() +
  labs(
    title = "Total Observations",
    x = "Year",
    y = "No. of Observations",
    caption = "Data from the BRFSS, p8105 datasets package") +
  theme(legend.position="none")
  
```


* Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.
    + The mean and standard deviation of the proportion of "Excellent" responses is pretty similar for NY state for all three years. 

```{r}

brfss %>% 
  filter(state == "NY", 
         response == "Excellent", 
         year == 2002 | year == 2006 | year ==2010) %>% 
  group_by(year) %>% 
  summarize(excel_mean = mean(data_value),
            excel_sd = sd(data_value)) %>% 
  knitr::kable(digits = 2)

```


* For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.
    * *Response*


## Problem #2